import os
from ultralytics import YOLO
from IPython.display import display, Image
from IPython import display as ipy_display

def run_nvidia_smi():
    get_ipython().system('nvidia-smi')

def install_ultralytics():
    get_ipython().system('pip install ultralytics')

def clear_output():
    ipy_display.clear_output()

def run_yolo_checks():
    get_ipython().system('yolo checks')

def install_roboflow():
    get_ipython().system('pip install roboflow')

def download_dataset():
    from roboflow import Roboflow
    rf = Roboflow(api_key="  ")
    project = rf.workspace("yolov8-7lsof").project("licenseplatedetection-bcet9")
    version = project.version(1)
    dataset = version.download("yolov8")
    return dataset

def train_model(dataset):
    get_ipython().system(f'yolo task=detect mode=train model=yolov8m.pt data={dataset.location}/data.yaml epochs=20 imgsz=640')

def show_train_images():
    display(Image(filename=r"C:\Users\USER\Documents\cacaotalk\runs\detect\train5\confusion_matrix.png", width=600))
    display(Image(filename=r"C:\Users\USER\Documents\cacaotalk\runs\detect\train5\results.png", width=600))

def predict_model(dataset):
    get_ipython().system(f'yolo task=detect mode=predict model="C:\Users\USER\Documents\cacaotalk\runs\detect\train5\weights\best.pt" data={dataset.location}/data.yaml')

def show_prediction_image():
    display(Image(filename=r"C:\Users\USER\Documents\cacaotalk\runs\detect\train5\val_batch0_pred.jpg", width=600))

def main():
    run_nvidia_smi()
    install_ultralytics()
    clear_output()
    run_yolo_checks()
    install_roboflow()
    dataset = download_dataset()      
    train_model(dataset)
    show_train_images()
    predict_model(dataset)
    show_prediction_image()

if __name__ == '__main__':
    main()  
